substitutions:
  font_glyphs: '&@!"''%()<>+=,-_.:°/$€£¥?0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ abcdefghijklmnopqrstuvwxyzÀàÁáÂâÃãÄäĀāĂăÅåǺǻẠạĄąÆæǼǽĆćĈĉČčĊċÇçĎďĐđÐðÈèÉéÊêẼẽĚěËëĒēĔĕĖėẸẹĘęĜĝǦǧĞğĠġĢģĤĥĦħıÌìÍíÎîĨĩÏïĪīĬĭİỊịĮįȷĴĵĶķĸĹĺĽľĻļŁłĿŀŃńÑñŇňŅņƝɲŊŋŉÒòÓóÔôÕõÖöŌōŎŏŐőỌọǪǫØøǾǿŒœŔŕŘřŖŗŚśŜŝŠšŞşȘșẞßŤťŢţȚțŦŧÞþÙùÚúÛûŨũÜüŪūŬŭŮůŰűỤụŲųẀẁẂẃŴŵẄẅỲỳÝýŶŷỸỹŸÿȲȳŹźŽžŻżĲĳƏə'  
esphome:
  name: bedroom-display
  friendly_name: Bedroom Display
  on_boot:
    - lambda: id(back_light).turn_on().set_brightness(1.0).set_transition_length(1).perform(); 

esp32:
  board: esp32s3box
  framework:
    type: esp-idf
    sdkconfig_options:
      CONFIG_ESP32S3_DEFAULT_CPU_FREQ_240: "y"
      CONFIG_ESP32S3_DATA_CACHE_64KB: "y"
      CONFIG_ESP32S3_DATA_CACHE_LINE_64B: "y"
  flash_size: 16MB

psram:
  mode: octal
  speed: 80MHz
  
api:
logger:
  hardware_uart: USB_SERIAL_JTAG
  # level: error
wifi: 
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  use_address: 192.168.1.142
  # manual_ip:
    # static_ip: 192.168.2.147
    # gateway: 192.168.2.1
    # subnet: 255.255.255.0
ota:
  platform: esphome
  
time:
  - platform: homeassistant
    id: sntp_time
    on_time_sync:
      - script.execute: time_update
    on_time:
      - minutes: '*'
        seconds: 0
        then:
          - script.execute: time_update
      - hours: 2
        minutes: 0
        seconds: 0
        then:
          - switch.turn_on: switch_antiburn
      - hours: 2
        minutes: 15
        seconds: 0
        then:
          - switch.turn_off: switch_antiburn

i2c:
  - id: bus_a
    sda: GPIO08
    scl: GPIO18
    scan: true
    sda_pullup_enabled: true
    scl_pullup_enabled: true
    frequency: 50kHz

  - sda: GPIO41
    scl: GPIO40
    scan: false
    sda_pullup_enabled: true
    scl_pullup_enabled: true
    frequency: 50kHz
    id: bus_b
spi:
  clk_pin: 7
  mosi_pin: 6

display:
  - platform: ili9xxx
    id: device_display
    model: S3BOX
    data_rate: 40MHz
    cs_pin: 5
    dc_pin: 4
    reset_pin:
      number: 48
      inverted: true
    update_interval: never
    invert_colors: false
    auto_clear_enabled: false

touchscreen:
  platform: gt911
  i2c_id: bus_a
  address: 0x5D
  id: device_touchscreen
  interrupt_pin:
    number: GPIO3
    ignore_strapping_warning: true
  on_touch:
    - delay: 30s
    - lambda: id(back_light).turn_on().set_brightness(.30).set_transition_length(1).perform();

output:
  - platform: ledc
    pin: GPIO47
    id: backlight_output

light:
  - platform: monochromatic
    id: back_light
    name: LCD Backlight
    entity_category: config
    output: backlight_output
    restore_mode: ALWAYS_ON
    default_transition_length: 50ms

interval:
  - interval: 1s
    then:
      - lambda: |-
          static int countdown = 0;
          if (id(countdown_control).state) {
            if (countdown == 0) {
              countdown = 60;
            }
            if (countdown > 0) {
              id(countdown_timer).publish_state((std::to_string(countdown) + "seconds").c_str());
              countdown--;
            } else {
              id(countdown_timer).publish_state("Time's up!");
              id(countdown_control).turn_off();  // Auto turn off switch when countdown finishes
            }
          }

globals:
  - id: current_pin
    type: std::string
    initial_value: ""
  - id: time_set_hour
    type: int
    initial_value: "12"
  - id: time_set_minute
    type: int
    initial_value: "0"
  - id: time_set_am_pm
    type: std::string
    initial_value: '"PM"'

button:
  - platform: restart
    id: reboot
    name: reboot

switch:
  - platform: template
    id: ceiling_light_switch
    optimistic: true
    on_turn_off: 
      - homeassistant.action:
          action: light.turn_off
          data:
            entity_id: light.entrance_ceiling
    on_turn_on:
      - homeassistant.service:
          service: light.turn_on
          data:
            entity_id: light.entrance_ceiling
            brightness: '255'

  - platform: template
    id: home_page_flag
    optimistic: true

  - platform: template
    id: countdown_control
    optimistic: true
    on_turn_off: 
      - lvgl.page.show: clock_page
      - script.execute: backlight_off

  - platform: template
    name: Antiburn
    id: switch_antiburn
    icon: mdi:television-shimmer
    optimistic: true
    entity_category: "config"
    turn_on_action:
      - logger.log: "Starting Antiburn"
      - if:
          condition: lvgl.is_paused
          then:
            - lvgl.resume:
            - lvgl.widget.redraw:
      - lvgl.pause:
          show_snow: true
    turn_off_action:
      - logger.log: "Stopping Antiburn"
      - if:
          condition: lvgl.is_paused
          then:
            - lvgl.resume:
            - lvgl.widget.redraw:

text_sensor:
  - platform: wifi_info
    ip_address:
      name: IP Address
      id: ip_addr
      entity_category: "diagnostic"
    ssid:
      id: connected_ssid
      name: SSID
      entity_category: "diagnostic"
    bssid:
      id: connected_bssid
      name: BSSID
      entity_category: "diagnostic"
    mac_address:
      id: device_mac

  - platform: homeassistant
    id: met_weather
    entity_id: weather.home
    on_value:
      then:
        - script.execute: weather_update
        - lvgl.label.update:
            id:
              - display_weather_text
            text: !lambda return x;
         
  - platform: template
    id: pin_test

  - platform: homeassistant
    name: "Alarm Status"
    entity_id: alarm_control_panel.alarmo
    id: alarm_status    
    on_value:
      if:
        condition:
          - lambda: return id(alarm_status).state == "arming";
        then:
          - lvgl.label.update: 
              id: alarm_status_lvgl
              text_color: amber
          - lvgl.label.update: 
              id: disarm_lvgl
              text_color: amber
        else:
          - if:
              condition:
                - lambda: return id(alarm_status).state == "armed_home";
              then:
                - lvgl.label.update: 
                    id: alarm_status_lvgl
                    text_color: red
                    text: "\U000F068A"
                - lvgl.label.update: 
                    id: disarm_lvgl
                    text_color: red
                    text: "\U000F068A"
                - lvgl.label.update:
                    id: alarm_arm_home_lvgl
                    bg_color: red
                    text: "Armed Home"
              else:
                - if:
                    condition:
                      - lambda: return id(alarm_status).state == "armed_away";
                    then:
                      - lvgl.label.update: 
                          id: alarm_status_lvgl
                          text_color: red
                          text: "\U000F099D"
                      - lvgl.label.update: 
                          id: disarm_lvgl
                          text_color: red
                          text: "\U000F099D"
                      - lvgl.label.update:
                          id: alarm_arm_away_lvgl
                          bg_color: red
                          text: "Armed Away"
                    else:
                      - if:
                          condition:
                            - lambda: return id(alarm_status).state == "armed_night";
                          then:
                            - lvgl.label.update: 
                                id: alarm_status_lvgl
                                text_color: red
                                text: "\U000F1828"
                            - lvgl.label.update: 
                                id: disarm_lvgl
                                text_color: red
                                text: "\U000F1828"
                            - lvgl.label.update:
                                id: alarm_arm_night_lvgl
                                bg_color: red
                                text: "Armed Night"
                          else:
                            - if:
                                condition:
                                  - lambda: return id(alarm_status).state == "disarmed";
                                then:
                                  - lvgl.label.update: 
                                      id: alarm_status_lvgl
                                      text_color: green
                                      text: "\U000F099E"
                                  - lvgl.label.update: 
                                      id: disarm_lvgl
                                      text_color: green
                                      text: "\U000F099E"
                                  - lvgl.label.update: 
                                      id: alarm_arm_away_lvgl
                                      bg_color: green
                                      text: "Arm Away"
                                  - lvgl.label.update: 
                                      id: alarm_arm_night_lvgl
                                      bg_color: green
                                      text: "Arm Night"
                                  - lvgl.label.update: 
                                      id: alarm_arm_home_lvgl
                                      bg_color: green
                                      text: "Arm Home"
                                  - switch.turn_off: countdown_control
                                else:
                                  if: 
                                    condition:
                                      - lambda: return id(alarm_status).state == "triggered";
                                    then:
                                      lvgl.page.show: triggered_page
                                    else:
                                      if:
                                        condition:
                                          - lambda: return id(alarm_status).state == "pending";
                                        then: 
                                          - lvgl.page.show: disarming_page
                                          - switch.turn_on: countdown_control

  - platform: template
    id: countdown_timer
    # name: countdown  
    on_value:
      - lvgl.label.update: 
          id: entrance_delay_lvgl
          text: !lambda return x;
  - platform: homeassistant
    name: "Time Input"
    id: input_datetime_time
    entity_id: input_datetime.time
    internal: true
    on_value:
      then:
        - lambda: |-
            ESP_LOGD("TIME", "Received new time: %s", x.c_str());
            // Update global variables
            std::string time_str = x;
            int hour_24 = 8;
            int minute = 30;
            if (time_str.length() >= 5) {
              size_t colon_pos = time_str.find(":");
              if (colon_pos != std::string::npos) {
                hour_24 = atoi(time_str.substr(0, colon_pos).c_str());
                minute = atoi(time_str.substr(colon_pos+1, 2).c_str());
              }
            }
            id(time_set_hour) = (hour_24 % 12 == 0) ? 12 : (hour_24 % 12);
            id(time_set_am_pm) = (hour_24 < 12) ? "AM" : "PM";
            id(time_set_minute) = minute;

script:
  - id: time_update
    then:
      - lvgl.label.update:
          id: display_time_blank
          text: !lambda |-
            auto now = id(sntp_time).now();
            int hour = now.hour % 12;
            if (hour == 0) hour = 12;
            return str_sprintf("%d:%02d%s", hour, now.minute, now.hour < 12 ? "am" : "pm");

      - lvgl.label.update:
          id: display_date
          text: !lambda |-
            static const char * const days[] = {"Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"};
            static const char * const months[] = {"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"};
            
            auto now = id(sntp_time).now();
            const char *suffix = (now.day_of_month > 10 && now.day_of_month < 14) ? "th" : 
              (const char*[]){"th","st","nd","rd","th","th","th","th","th","th"}[now.day_of_month % 10];
            
            static char date_buf[64];
            snprintf(date_buf, sizeof(date_buf), "%s, %s %d%s %04d", 
              days[now.day_of_week - 1], months[now.month - 1], now.day_of_month, suffix, now.year);
            return date_buf;

  - id: backlight_off      
    then:
      - light.turn_on: back_light
      - delay: 60s
      - if:
          condition:
            not:
              - lambda: return id(alarm_status).state == "triggered";
          then:
            - lvgl.page.show: clock_page
            - delay: 180s
            - light.turn_off: back_light
    mode: restart

  - id: weather_update
    then:
      - if:
          condition:
            - lambda: return id(met_weather).state == "rainy";
          then:
            - lvgl.label.update:
                id: 
                  - display_weather
                  
                text_font: icon_font_80
                text: "\U000F0597"
          else:
            - if:
                condition:
                  - lambda: return id(met_weather).state == "clear-night";
                then:
                  - lvgl.label.update:
                      id: 
                        - display_weather
                        
                      text_font: icon_font_80
                      text: "\U000F0594"               
                else:
                  - if:
                      condition:
                        - lambda: return id(met_weather).state == "exceptional";
                      then:
                        - lvgl.label.update:
                            id: 
                              - display_weather
                              
                            text_font: icon_font_80
                            text: "\U000F0590"
                      else:
                        - if:
                            condition:
                              - lambda: return id(met_weather).state == "hail";
                            then:
                              - lvgl.label.update:
                                  id: 
                                    - display_weather
                                    
                                  text_font: icon_font_80
                                  text: "\U000F0592"
                            else:
                              - if:
                                  condition:
                                    - lambda: return id(met_weather).state == "lightning";
                                  then:
                                    - lvgl.label.update:
                                        id: 
                                          - display_weather
                                          
                                        text_font: icon_font_80
                                        text: "\U000F0593"
                                  else:
                                    - if:
                                        condition:
                                          - lambda: return id(met_weather).state == "lightning-rainy";
                                        then:
                                          - lvgl.label.update:
                                              id: 
                                                - display_weather
                                                
                                              text_font: icon_font_80
                                              text: "\U000F067E"
                                        else:
                                          - if:
                                              condition:
                                                - lambda: return id(met_weather).state == "partlycloudy";
                                              then:
                                                - lvgl.label.update:
                                                    id: 
                                                      - display_weather
                                                      
                                                    text_font: icon_font_80
                                                    text: "\U000F0595"
                                              else:
                                                - if:
                                                    condition:
                                                      - lambda: return id(met_weather).state == "pouring";
                                                    then:
                                                      - lvgl.label.update:
                                                          id: 
                                                            - display_weather
                                                            
                                                          text_font: icon_font_80
                                                          text: "\U000F0596"           
                                                    else:
                                                      - if:
                                                          condition:
                                                            - lambda: return id(met_weather).state == "snowy";
                                                          then:
                                                            - lvgl.label.update:
                                                                id: 
                                                                  - display_weather
                                                                  
                                                                text_font: icon_font_80
                                                                text: "\U000F0598"  
                                                          else:
                                                            - if:
                                                                condition:
                                                                  - lambda: return id(met_weather).state == "snowy-rainy";
                                                                then:
                                                                  - lvgl.label.update:
                                                                      id: 
                                                                        - display_weather
                                                                        
                                                                      text_font: icon_font_80
                                                                      text: "\U000F067F"  
                                                                else:
                                                                  - if:
                                                                      condition:
                                                                        - lambda: return id(met_weather).state == "sunny";
                                                                      then:
                                                                        - lvgl.label.update:
                                                                            id: 
                                                                              - display_weather
                                                                              
                                                                            text_font: icon_font_80
                                                                            text: "\U000F0599"    
                                                                      else:
                                                                        - if:
                                                                            condition:
                                                                              - lambda: return id(met_weather).state == "sunny-rainy";
                                                                            then:
                                                                              - lvgl.label.update:
                                                                                  id: 
                                                                                    - display_weather
                                                                                    
                                                                                  text_font: icon_font_80
                                                                                  text: "\U000F0596"  
                                                                            else:
                                                                              - if:
                                                                                  condition:
                                                                                    - lambda: return id(met_weather).state == "windy";
                                                                                  then:
                                                                                    - lvgl.label.update:
                                                                                        id: 
                                                                                          - display_weather
                                                                                          
                                                                                        text_font: icon_font_80
                                                                                        text: "\U000F059D"  
                                                                                  else:
                                                                                    - if:
                                                                                        condition:
                                                                                          - lambda: return id(met_weather).state == "windy-variant";
                                                                                        then:
                                                                                          - lvgl.label.update:
                                                                                              id: 
                                                                                                - display_weather
                                                                                                
                                                                                              text_font: icon_font_80
                                                                                              text: "\U000F059E" 
                                                                                        else:
                                                                                          - if:
                                                                                              condition:
                                                                                                - lambda: return id(met_weather).state == "sunny-off";
                                                                                              then:
                                                                                                - lvgl.label.update:
                                                                                                    id: 
                                                                                                      - display_weather
                                                                                                      
                                                                                                    text_font: icon_font_80
                                                                                                    text: "\U000F14E4"  
                                                                                              else:
                                                                                                - if:
                                                                                                    condition:
                                                                                                      - lambda: return id(met_weather).state == "cloudy";
                                                                                                    then:
                                                                                                      - lvgl.label.update:
                                                                                                          id: 
                                                                                                            - display_weather
                                                                                                            
                                                                                                          text_font: icon_font_80
                                                                                                          text: "\U000F0590"


sensor:  
  - platform: wifi_signal
    name: "WiFi db"
    id: wifi_signal_db
    update_interval: 30s
    
  - platform: copy 
    source_id: wifi_signal_db
    name: "WiFi Signal"
    id: wifi_percent
    filters:
      - lambda: return min(max(2 * (x + 100.0), 0.0), 100.0);
    unit_of_measurement: "%"
    entity_category: "diagnostic"
    device_class: ""   
    
  - platform: homeassistant
    id: out_temp
    entity_id: sensor.outside_temperature
    internal: true 
    on_value:
      - lvgl.label.update:
          id: 
            - out_temp_lvgl
          text:
            format: "%.0f°C"
            args: [ 'x' ]
  - platform: homeassistant
    id: input_datetime_time_text
    entity_id: input_datetime.time
    internal: true

binary_sensor:
  - platform: gt911
    id: home_button
    index: 0
    on_press:
      then:
        - if:
            condition:
              switch.is_on: home_page_flag
            then:
              - lvgl.page.show: clock_page
            else:
              - lvgl.page.show: button_page
        - light.turn_on: back_light

  - platform: homeassistant
    id: morning_backup_automation
    entity_id: automation.morning_backup
    on_state:
      then:
        - lvgl.widget.update:
            id: automation_toggle
            state:
              checked: !lambda return x;
        - lvgl.label.update:
            id: heat_boost_lvgl

            
  - platform: homeassistant
    id: outside_light_state
    entity_id: light.front_outside_light
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: button_1
            state:
              checked: !lambda return x;
        - if:
            condition:
              lambda: return x == true;  
            then:
              - lvgl.label.update:
                  id: outside_light_lvgl
                  text_color: yellow
            else:
              - lvgl.label.update:
                  id: outside_light_lvgl
                  text_color: white

  - platform: homeassistant
    id: ceiling_light_state
    entity_id: light.entrance_ceiling
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: button_2
            state:
              checked: !lambda return x;  
        - if:
            condition:
              lambda: return x == true;  
            then:
              - lvgl.label.update:
                  id: ceiling_light_lvgl
                  text_color: yellow
            else:
              - lvgl.label.update:
                  id: ceiling_light_lvgl
                  text_color: white

  - platform: homeassistant
    id: stairs_light_state
    entity_id: light.stairs_led
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: button_3
            state:
              checked: !lambda return x;  
        - if:
            condition:
              lambda: return x == true;  
            then:
              - lvgl.label.update:
                  id: stairs_light_lvgl
                  text_color: yellow
            else:
              - lvgl.label.update:
                  id: stairs_light_lvgl
                  text_color: white

  - platform: homeassistant
    id: hallway_state
    entity_id: light.hallway_ceiling
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: button_4
            state:
              checked: !lambda return x;
        - if:
            condition:
              lambda: return x == true;  
            then:
              - lvgl.label.update:
                  id: hallway_room_lvgl
                  text_color: yellow
            else:
              - lvgl.label.update:
                  id: hallway_room_lvgl
                  text_color: white  
               
  - platform: homeassistant
    id: hall_motion
    entity_id: binary_sensor.hallway_motion
    internal: true
    publish_initial_state: true
    on_state:
      then:
        script.execute: backlight_off

  - platform: homeassistant
    id: stairs_motion
    entity_id: binary_sensor.top_stairs_motion
    internal: true
    publish_initial_state: true
    on_state:
      then:
        script.execute: backlight_off

  - platform: homeassistant
    id: front_door
    entity_id: binary_sensor.frontdoor_door
    internal: true
    publish_initial_state: true
    on_state:
      then:
        script.execute: backlight_off

  - platform: homeassistant
    id: living_ceiling_state
    entity_id: light.livingroom_ceiling_led_colorflux_ls3
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: livingroom_ceiling_lvgl
            state:
              checked: !lambda return x;
        - if:
            condition:
              lambda: return x == true;  
            then:
              - lvgl.label.update:
                  id: livingroom_ceiling_lvgl
                  text_color: yellow
            else:
              - lvgl.label.update:
                  id: livingroom_ceiling_lvgl
                  text_color: white

  - platform: homeassistant
    id: stove_state
    entity_id: light.stove
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: kitchen_stove_lvgl
            state:
              checked: !lambda return x;
        - if:
            condition:
              lambda: return x == true;  
            then:
              - lvgl.label.update:
                  id: kitchen_stove_lvgl
                  text_color: yellow
            else:
              - lvgl.label.update:
                  id: kitchen_stove_lvgl
                  text_color: white

  - platform: homeassistant
    id: dining_light_state
    entity_id: light.dining_room_lights
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: dining_room_lights_lvgl
            state:
              checked: !lambda return x;
        - if:
            condition:
              lambda: return x == true;  
            then:
              - lvgl.label.update:
                  id: dining_room_lights_lvgl
                  text_color: yellow
            else:
              - lvgl.label.update:
                  id: dining_room_lights_lvgl
                  text_color: white

  - platform: homeassistant
    id: all_lights_state
    entity_id: light.all_lights
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: lights_status_lvgl
            state:
              checked: !lambda return x;
        - if:
            condition:
              lambda: return x == true;  
            then:
              - lvgl.label.update:
                  id: lights_status_lvgl
                  text_color: red
            else:
              - lvgl.label.update:
                  id: lights_status_lvgl
                  text_color: green    

  - platform: homeassistant
    id: all_windows_state
    entity_id: binary_sensor.windows
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: window_status_lvgl
            state:
              checked: !lambda return x;
        - if:
            condition:
              lambda: return x == true;  
            then:
              - lvgl.label.update:
                  id: window_status_lvgl
                  text_color: red
                  text:  "\U000F05B1"
            else:
              - lvgl.label.update:
                  id: window_status_lvgl
                  text_color: green
                  text: "\U000F05AE"
                  
  - platform: homeassistant
    id: all_doors_state
    entity_id: binary_sensor.outside_doors
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: door_status_lvgl
            state:
              checked: !lambda return x;
        - if:
            condition:
              lambda: return x == true;  
            then:
              - lvgl.label.update:
                  id: door_status_lvgl
                  text_color: red
                  text:  "\U000F081C"
            else:
              - lvgl.label.update:
                  id: door_status_lvgl
                  text_color: green 
                  text: "\U000F081B"

  - platform: homeassistant
    id: front_door_state
    entity_id: binary_sensor.frontdoor_door
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: status_front_door_label
            hidden: !lambda return !x;

  - platform: homeassistant
    id: back_door_state
    entity_id: binary_sensor.backdoor_door
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: status_back_door_label
            hidden: !lambda return !x;

  - platform: homeassistant
    id: bathroom_window_state
    entity_id: binary_sensor.bathroom_window
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: status_bathroom_window_label
            hidden: !lambda return !x;

  - platform: homeassistant
    id: charles_window_state
    entity_id: binary_sensor.charles_window
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: status_charles_window_label
            hidden: !lambda return !x;

  - platform: homeassistant
    id: mediaroom_window_state
    entity_id: binary_sensor.mediaroom_window
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: status_mediaroom_window_label
            hidden: !lambda return !x;

  - platform: homeassistant
    id: stephs_window_state
    entity_id: binary_sensor.stephs_window
    internal: true
    publish_initial_state: true
    on_state:
      then:
        - lvgl.widget.update:
            id: status_stephs_window_label
            hidden: !lambda return !x;
                  
font:
  - file: "gfonts://Montserrat"
    id: montserrat_12
    size: 12
  - file: "gfonts://Montserrat"
    id: montserrat_16
    size: 16
  - file: "gfonts://Montserrat"
    id: montserrat_18
    size: 18
  - file: "gfonts://Montserrat"
    id: montserrat_20
    size: 20
  - file: "gfonts://Montserrat"
    id: montserrat_24
    size: 24
  - file: "gfonts://Montserrat"
    id: montserrat_40
    size: 40
  - file: "gfonts://Montserrat"
    id: montserrat_48
    size: 48
  - file: "https://github.com/BigBobbas/ESP32-S3-Box3-Custom-ESPHome/raw/main/fonts/consola.ttf"
    id: my_font80
    size: 80

  - file: "https://github.com/BigBobbas/ESP32-S3-Box3-Custom-ESPHome/raw/main/fonts/consola.ttf"
    id: my_font40
    size: 40
    # bpp: 4     
    glyphs:
      '${font_glyphs}'
   
  - file: "https://github.com/BigBobbas/ESP32-S3-Box3-Custom-ESPHome/raw/main/fonts/consola.ttf"
    id: my_font160
    size: 160
    glyphs:
      '${font_glyphs}'

  - file: "https://github.com/BigBobbas/ESP32-S3-Box3-Custom-ESPHome/raw/main/fonts/materialdesignicons-webfont.ttf"
    id: icon_font_80
    size: 40
    bpp: 4
    glyphs: &icon_glyphs 
      - "\U000F0590" # mdi-weather-cloudy
      - "\U000F0F2F" # mdi-weather-cloudy-alert
      - "\U000F0E6E" # mdi-weather-cloudy-arrow-right
      - "\U000F0591" # mdi-weather-fog
      - "\U000F0592" # mdi-weather-hail
      - "\U000F0F30" # mdi-weather-hazy
      - "\U000F0898" # mdi-weather-hurricane
      - "\U000F0593" # mdi-weather-lightning
      - "\U000F067E" # mdi-weather-lightning-rainy
      - "\U000F0594" # mdi-weather-night
      - "\U000F0F31" # mdi-weather-night-partly-cloudy
      - "\U000F0595" # mdi-weather-partly-cloudy
      - "\U000F0F32" # mdi-weather-partly-lightning
      - "\U000F0F33" # mdi-weather-partly-rainy
      - "\U000F0F34" # mdi-weather-partly-snowy
      - "\U000F0F35" # mdi-weather-partly-snowy-rainy
      - "\U000F0596" # mdi-weather-pouring
      - "\U000F0597" # mdi-weather-rainy
      - "\U000F0598" # mdi-weather-snowy
      - "\U000F0F36" # mdi-weather-snowy-heavy
      - "\U000F067F" # mdi-weather-snowy-rainy
      - "\U000F0599" # mdi-weather-sunny
      - "\U000F0F37" # mdi-weather-sunny-alert
      - "\U000F14E4" # mdi-weather-sunny-off
      - "\U000F059A" # mdi-weather-sunset
      - "\U000F059B" # mdi-weather-sunset-down
      - "\U000F059C" # mdi-weather-sunset-up
      - "\U000F0F38" # mdi-weather-tornado
      - "\U000F059D" # mdi-weather-windy
      - "\U000F059E" # mdi-weather-windy-variant   F072A
      - "\U000F0450" # mdi-refresh
      - "\U000F0A19" # mdi-toggle off
      - "\U000F0521" # mdi-toggle on
      - "\U000F024A" # mdi-garden
      - "\U000F04C8" # mdi-spots
      - "\U000F1722" # mdi-fire off
      - "\U000F02DC" # mdi-home button
      - "\U000F0B2A" # mdi-right
      - "\U000F04B9" # mdi-living room
      - "\U000F1061" # mdi-dining
      - "\U000F04DE" # mdi-kitchen stove
      - "\U000F1051" # mdi-led strip variant
      - "\U000F06E8" # mdi-light bulb illuminated
      - "\U000F0335" # mdi-light bulb off
      - "\U000F0210" # mdi-fan
      - "\U000F050F" # mdi-temp
      - "\U000F0769" # mdi-ceiling
      - "\U000F18DD" # mdi-ceiling multiple
      - "\U000F1798" # mdi-ceiling fan light
      - "\U000F091C" # mdi-wall light
      - "\U000F1B94" # mdi-sleep
      - "\U000F04CD" # mdi-stairs
      - "\U000F07D0" # mdi-api connected
      - "\U000F1828" # mdi-armed night
      - "\U000F068A" # mdi-alarm home
      - "\U000F099D" # mdi-alarm away
      - "\U000F099E" # mdi-disarmed
      - "\U000F0483" # mdi-security
      - "\U000F081B" # mdi-door closed
      - "\U000F081C" # mdi-door open
      - "\U000F1254" # mdi-lights group
      - "\U000F05B1" # mdi-windows open
      - "\U000F05AE" # mdi-windows closed
      - "\U000F0020" # mdi-alarm clock

  - file: "https://github.com/BigBobbas/ESP32-S3-Box3-Custom-ESPHome/raw/main/fonts/materialdesignicons-webfont.ttf"
    id: icon_font_120
    size: 60
    glyphs: *icon_glyphs

  - file: "https://github.com/BigBobbas/ESP32-S3-Box3-Custom-ESPHome/raw/main/fonts/materialdesignicons-webfont.ttf"
    id: icon_font_60
    size: 30
    bpp: 4
    glyphs: *icon_glyphs
          
  - file: "https://github.com/BigBobbas/ESP32-S3-Box3-Custom-ESPHome/raw/main/fonts/materialdesignicons-webfont.ttf"
    id: icon_font_180
    size: 90
    glyphs: *icon_glyphs

  - file: "https://github.com/BigBobbas/ESP32-S3-Box3-Custom-ESPHome/raw/main/fonts/materialdesignicons-webfont.ttf"
    id: icon_font_40
    size: 20
    bpp: 4
    glyphs: *icon_glyphs 
     
color:
  - id: gray
    hex: '999999'
  - id: green
    hex: '75D15F'
  - id: leaf_green
    hex: '60A86A'
  - id: red
    hex: 'FF3131'
  - id: blue
    hex: '47B7E9'
  - id: blue_drk
    hex: '085296'
  - id: amber
    hex: 'FBAB35'
  - id: lime
    hex: '20FC30'
  - id: pink
    hex: 'D92BBC'
  - id: yellow
    hex: 'FFC000'
  - id: black
    hex: '000000'
  - id: white
    hex: 'ffffff'
  - id: purple
    hex: '73264D'
  - id: light_blue
    hex: '2E98DA'
  - id: lilac
    hex: 'D6BED0'
  - id: bg_blue
    hex: '032341'
  - id: bg_purple
    hex: 'A16793'
  - id: bg_green
    hex: '05350B'
  - id: bg_red
    hex: '3C0000'
  - id: bg_pink
    hex: '61034D'
  - id: bg_charcoal
    hex: '141414'
  - id: bg_brown
    hex: '41220D'
  - id: bg_grey
    hex: '4F4F4F'
  - id: dk_blue
    hex: '0033cc'

key_collector:
  - source_id: lvgl_keypad
    min_length: 4
    max_length: 4
    end_keys: "#"
    end_key_required: true
    back_keys: "*"
    allowed_keys: "0123456789*#"
    timeout: 5s
    on_progress:
      - if:
          condition:
            lambda: return (0 != x.compare(std::string{""}));
          then:
            - lvgl.label.update:
                id: lvgl_label
                text: !lambda 'return x.c_str();'
                text_color: white
          else:
            - lvgl.label.update:
                id: lvgl_label
                text: "Enter Code"
                text_color: grey
    on_result:
      - lambda: |-
          id(current_pin) = x.c_str();
      - homeassistant.service:
          service: alarm_control_panel.alarm_disarm
          data:
            entity_id: alarm_control_panel.alarmo
            code: !lambda return id(current_pin).c_str();

lvgl:
  displays:
    - device_display
  touchscreens:
    - device_touchscreen
  theme:
    button:
      bg_color: black
      bg_opa: COVER
      border_color: 0x53334B
      border_width: 0
      text_color: white
      radius: 20
      shadow_color: black
      shadow_ofs_x: 0
      shadow_ofs_y: 0
      shadow_spread: 3
      shadow_width: 5
      shadow_opa: 70%
      checked: 
        bg_color: black
        bg_opa: COVER
        border_color: black
        border_width: 0
        text_color: yellow
        radius: 20
        shadow_color: black
        shadow_ofs_x: 0
        shadow_ofs_y: 0
        shadow_spread: 5
        shadow_width: 5
        shadow_opa: 70%

    switch:
      bg_color: 0xC0C0C0
      bg_grad_color: 0xb0b0b0
      bg_grad_dir: VER
      bg_opa: COVER
      checked:
        bg_color: 0x1d5f96
        bg_grad_color: 0x03324A
        bg_grad_dir: VER
        bg_opa: COVER
      knob:
        bg_color: 0xFFFFFF
        bg_grad_color: 0xC0C0C0
        bg_grad_dir: VER
        bg_opa: COVER
    slider:
      border_width: 1
      border_opa: 15%
      bg_color: 0xcccaca
      bg_opa: 15%
      indicator:
        bg_color: 0x1d5f96
        bg_grad_color: 0x03324A
        bg_grad_dir: VER
        bg_opa: COVER
      knob:
        bg_color: 0x2F8CD8
        bg_grad_color: 0x005782
        bg_grad_dir: VER
        bg_opa: COVER
        border_color: 0x0077b3
        border_width: 0
        text_color: 0xFFFFFF
    image: 
      border_width: 0
        
  style_definitions:
    - id: main_content
      bg_color: black
      text_color: amber
      text_align: CENTER
      width: 100%
      height: 80%    
      align: TOP_MID
      border_width: 0
      radius: 0     
     
    - id: bottom_content_bar
      bg_color: bg_charcoal
      text_color: amber
      text_align: left
      text_font: montserrat_10
      align: BOTTOM_LEFT
      width: 100%
      height: 20%    
      border_width: 0
      radius: 0

    - id: triggered_content
      bg_color: red
      text_color: amber
      text_align: CENTER
      width: 100%
      height: 100%    
      align: TOP_MID
      border_width: 0
      radius: 0     
                            
#################### bottom bar ####################
  top_layer:
      widgets:
        - obj:
            id: bottom_bar
            styles: bottom_content_bar
            text_color: grey
            scrollbar_mode: "OFF"
            widgets:            
              - label:
                  id: out_temp_lvgl_icon
                  align: LEFT_MID
                  text_font: icon_font_40
                  text_color: grey
                  text: "\U000F050F"

              - label:
                  id: out_temp_lvgl
                  align: LEFT_MID
                  translate_x: 40
                  translate_y: 5
                  text_color: grey
                  text: " "

              - label:
                  id: display_weather
                  align: CENTER
                  translate_x: -100
                  text_font: icon_font_80
                  text: " " 

              - label:
                  id: display_weather_text
                  align: CENTER
                  translate_x: 60
                  text_font: montserrat_20
                  text: " " 

              - label:
                  id: home_lvgl
                  align: BOTTOM_RIGHT
                  text_color: grey
                  text_font: icon_font_60
                  text: "\U000F02DC"
                  on_click:
                    - if:
                        condition:
                          switch.is_on: home_page_flag
                        then: 
                          lvgl.page.show: clock_page
                        else:
                          lvgl.page.show: button_page

              - label:
                  id: alarm_status_lvgl
                  align: BOTTOM_RIGHT
                  translate_x: -75
                  text_font: icon_font_60
                  text_color: red
                  text: "\U000F099E"
                  on_click:
                    if:
                      condition:
                        - lambda: return (id(alarm_status).state == "arming" || id(alarm_status).state == "armed_away" || id(alarm_status).state == "armed_home" || id(alarm_status).state == "armed_night");
                      then:
                        lvgl.page.show: disarm_page
                      else:
                        lvgl.page.show: alarm_page

#################### buttons page ####################
  pages:
    - id: button_page
      widgets:
        - obj: 
            styles: main_content
            text_font: montserrat_12
            layout: 
              pad_column: 10
              pad_row: 2
              type: GRID 
              grid_columns: [FR(1), FR(1), FR(1), FR(1)] 
              grid_rows: [FR(70), FR(20), FR(70), FR(20)]

            widgets:
              - button:
                  bg_color: black
                  border_side: NONE
                  border_width: 0
                  checkable: true
                  id: button_1
                  grid_cell_column_pos: 0
                  grid_cell_row_pos: 0
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  pressed:
                    bg_color: red
                  widgets:
                    - label:
                        id: outside_light_lvgl
                        text_font: icon_font_120
                        text: "\U000F024A"
                        text_color: white
                        align: CENTER  
                  on_click:
                    - homeassistant.action:
                        action: light.toggle
                        data:
                          entity_id: light.front_outside_light
              - label:
                  grid_cell_column_pos: 0 
                  grid_cell_row_pos: 1 
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  text: "Outside"
                  text_align: CENTER                  

              - button:
                  bg_color: black
                  border_side: NONE
                  border_width: 0
                  checkable: true
                  id: button_2
                  grid_cell_column_pos: 1
                  grid_cell_row_pos: 0
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  pressed:
                    bg_color: red
                  widgets:
                    - label:
                        id: ceiling_light_lvgl
                        text_font: icon_font_120
                        text: "\U000F0769"
                        text_color: white
                        align: CENTER
                  on_click:
                      switch.toggle: ceiling_light_switch
              - label:
                  grid_cell_column_pos: 1 
                  grid_cell_row_pos: 1 
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  text: "Ceiling"
                  text_align: CENTER                  

              - button:
                  bg_color: black
                  border_side: NONE
                  border_width: 0
                  checkable: true
                  id: button_3
                  grid_cell_column_pos: 2
                  grid_cell_row_pos: 0
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  pressed:
                    bg_color: red
                  widgets:
                    - label:
                        id: stairs_light_lvgl
                        text_font: icon_font_120
                        text: "\U000F04CD" 
                        text_color: white
                        align: CENTER
                  on_click:
                    - homeassistant.action:
                        action: light.toggle
                        data:
                          entity_id: light.stairs_led                                  
              - label:
                  grid_cell_column_pos: 2 
                  grid_cell_row_pos: 1 
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  text: "Stairs"
                  text_align: CENTER                  

              - button:
                  bg_color: black
                  border_side: NONE
                  border_width: 0
                  checkable: true
                  id: button_4
                  grid_cell_column_pos: 3
                  grid_cell_row_pos: 0
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  pressed:
                    bg_color: red
                  widgets:
                    - label:
                        id: hallway_room_lvgl
                        text_font: icon_font_120
                        text: "\U000F0769"
                        text_color: white
                        align: CENTER
                  on_click:
                    - homeassistant.action:
                        action: light.toggle
                        data:
                          entity_id: light.hallway_ceiling
              - label:                        
                  grid_cell_column_pos: 3 
                  grid_cell_row_pos: 1 
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  text: "Hallway"
                  text_align: CENTER                                   
                 
#################### second row ####################
              - button:
                  bg_color: black
                  border_side: NONE
                  border_width: 0
                  checkable: true
                  id: button_5
                  grid_cell_column_pos: 0
                  grid_cell_row_pos: 2
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  pressed:
                    bg_color: red
                  widgets:
                    - label:
                        id: livingroom_ceiling_lvgl
                        text_font: icon_font_120
                        text: "\U000F04B9"  
                        text_color: white
                        align: CENTER
                  on_press:
                    then: 
                      - homeassistant.service:
                          service: light.toggle
                          data:
                            entity_id: light.livingroom_ceiling_led_colorflux_ls3
              - label:
                  grid_cell_column_pos: 0
                  grid_cell_row_pos: 3
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  text: "LivingRM"
                  text_align: CENTER                  

              - button:
                  bg_color: black
                  border_side: NONE
                  border_width: 0
                  checkable: true
                  id: button_6
                  grid_cell_column_pos: 1
                  grid_cell_row_pos: 2
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  pressed:
                    bg_color: red
                  widgets:
                    - label:
                        id: kitchen_stove_lvgl
                        text_font: icon_font_120
                        text: "\U000F04DE"
                        text_color: white
                        align: CENTER
                  on_press:
                    then: 
                      - homeassistant.service:
                          service: light.toggle
                          data:
                            entity_id: light.stove
              - label:
                  grid_cell_column_pos: 1
                  grid_cell_row_pos: 3
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  text: "Kitchen"
                  text_align: CENTER                  

              - button:
                  bg_color: black
                  border_side: NONE
                  border_width: 0
                  checkable: true
                  id: button_7
                  grid_cell_column_pos: 2
                  grid_cell_row_pos: 2
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  pressed:
                    bg_color: red
                  widgets:
                    - label:
                        id: dining_room_lights_lvgl
                        text_font: icon_font_120
                        text: "\U000F1798"  
                        text_color: white
                        align: CENTER
                  on_press:
                    then: 
                      - homeassistant.service:
                          service: light.toggle
                          data:
                            entity_id: light.dining_room_lights
              - label:
                  grid_cell_column_pos: 2
                  grid_cell_row_pos: 3 
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  text: "DiningRM"
                  text_align: CENTER                  

              - button:
                  bg_color: black
                  border_side: NONE
                  border_width: 0
                  checkable: true
                  id: button_8
                  grid_cell_column_pos: 3
                  grid_cell_row_pos: 2
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  widgets:
                    - label:
                        id: heat_boost_lvgl
                        text_font: icon_font_120
                        text: "\U000F0020"
                        text_color: white
                        align: CENTER
                  on_click:
                    - lvgl.page.show: time_set_page 

              - label:
                  grid_cell_column_pos: 3
                  grid_cell_row_pos: 3 
                  grid_cell_x_align: STRETCH
                  grid_cell_y_align: STRETCH
                  text: "M.Alarm"
                  text_align: CENTER           

      on_load:   
        - switch.turn_on: home_page_flag       
      on_unload:
        - switch.turn_off: home_page_flag

#################### clock page ####################
    - id: clock_page
      widgets:
        - obj: 
            styles: main_content
            border_width: 0
            text_color: red
            widgets:    
              - label:
                  id: display_time_blank
                  align: CENTER
                  width: 100%
                  text_align: CENTER
                  text_color: red
                  text_font: montserrat_48
                  text: " " 
                  on_click:
                    lvgl.page.show: button_page
                  
              - label:
                  id: display_date
                  align: CENTER
                  text: " "
                  translate_y: 120
                  # translate_x: 100
                  text_font: montserrat_24

              - label:
                  id: door_status_lvgl
                  align: TOP_LEFT
                  text_font: icon_font_60
                  text_color: green
                  text: "\U000F081B"
                  on_click:
                    lvgl.page.show: status_page

              - label:
                  id: window_status_lvgl
                  align: TOP_LEFT
                  translate_x: 80
                  text_font: icon_font_60
                  text_color: green
                  text: "\U000F05AE"
                  on_click:
                    lvgl.page.show: status_page

              - label:
                  id: lights_status_lvgl
                  align: TOP_LEFT
                  translate_x: 160
                  text_font: icon_font_60
                  text_color: green
                  text: "\U000F1254"
                  on_click:
                    lvgl.page.show: status_page

              - label:
                  id: settings_page_lvgl
                  align: TOP_RIGHT
                  # translate_x: 160
                  border_width: 5
                  text_font: icon_font_60
                  text_color: black
                  text: " "
                  on_click:
                    lvgl.page.show: settings_page

#################### alarm page ####################
    - id: alarm_page
      styles: main_content
      widgets:    
        - obj:
            width: 500
            height: 85
            align: TOP_MID
            scrollbar_mode: "OFF"         
            bg_opa: TRANSP   
            pad_all: 0
            widgets:
              - label:
                  id: alarm_arm_home_lvgl
                  align: CENTER
                  text_align: CENTER
                  text_font: montserrat_20
                  text: "Arm Home"
                  text_color: white
                  width: 100%
                  height: 100%
                  bg_opa: COVER
                  bg_color: green
                  pad_top: 20

            on_press:
              - homeassistant.service:
                  service: alarm_control_panel.alarm_arm_home
                  data:
                    entity_id: alarm_control_panel.alarmo
                    code: !lambda return id(current_pin).c_str();
              - lambda: |-
                  id(current_pin) = ""; 
        - obj:
            width: 500
            height: 85
            align: CENTER
            translate_y: -65
            scrollbar_mode: "OFF"            
            bg_opa: TRANSP   
            pad_all: 0
            widgets:
              - label:
                  id: alarm_arm_night_lvgl
                  align: CENTER
                  text_font: montserrat_20
                  text_align: CENTER
                  text: "Arm Night"
                  text_color: white
                  width: 100%
                  height: 100%
                  bg_opa: COVER
                  bg_color: green
                  pad_top: 20
            on_press:
              - homeassistant.service:
                  service: alarm_control_panel.alarm_arm_night
                  data:
                    entity_id: alarm_control_panel.alarmo
                    code: !lambda return id(current_pin).c_str();
              - lambda: |-
                  id(current_pin) = ""; 
        - obj:
            width: 500
            height: 85
            align: BOTTOM_MID
            translate_y: -130
            scrollbar_mode: "OFF"            
            bg_opa: TRANSP   
            pad_all: 0
            widgets:
              - label:
                  id: alarm_arm_away_lvgl
                  align: CENTER
                  text_font: montserrat_20
                  text_align: CENTER
                  text: "Arm Away"
                  text_color: white
                  width: 100%
                  height: 100%
                  bg_opa: COVER
                  bg_color: green
                  pad_top: 20
            on_press:
              - homeassistant.service:
                  service: alarm_control_panel.alarm_arm_away
                  data:
                    entity_id: alarm_control_panel.alarmo
                    code: !lambda return id(current_pin).c_str();
              - lambda: |-
                  id(current_pin) = ""; 

#################### disarm page ####################
    - id: disarm_page
      styles: main_content
      widgets:
        - obj: 
            styles: main_content
            border_width: 0
            widgets:
              - label:
                  id: lvgl_label
                  align: TOP_RIGHT
                  text_font: montserrat_20
                  text: "Enter Code"
                  text_align: CENTER
                  text_color: grey
                  translate_x: -145
                  translate_y: 15
        - obj:
            width: 315
            height: 200
            align: TOP_RIGHT
            translate_x: -60
            translate_y: 110
            border_width: 0
            bg_color: black
            scrollbar_mode: "OFF"            
            widgets:
              - label:
                  bg_color: black
                  id: disarm_lvgl
                  align: CENTER
                  text_font: icon_font_180
                  text: " "
      
        - buttonmatrix:
            id: lvgl_keypad
            x: 10
            y: 10
            width: 400
            height: 360
            text_font: montserrat_20
            bg_color: bg_charcoal
            border_width: 0
            items:
              pressed:
                bg_color: grey
            rows:
              - buttons:
                  - text: 1
                    control:
                      no_repeat: true
                  - text: 2
                    control:
                      no_repeat: true
                  - text: 3
                    control:
                      no_repeat: true
              - buttons:
                  - text: 4
                    control:
                      no_repeat: true
                  - text: 5
                    control:
                      no_repeat: true
                  - text: 6
                    control:
                      no_repeat: true
              - buttons:
                  - text: 7
                    control:
                      no_repeat: true
                  - text: 8
                    control:
                      no_repeat: true
                  - text: 9
                    control:
                      no_repeat: true
              - buttons:
                  - text: "\uF55A"
                    key_code: "*"
                    control:
                      no_repeat: true
                  - text: 0
                    control:
                      no_repeat: true
                  - text: '[#75D15F]'
                    key_code: "#"
                    control:
                      no_repeat: true
                      recolor: true

#################### triggered page ####################
    - id: triggered_page
      widgets:
        - obj: 
            styles: triggered_content
            border_width: 0
            text_color: white
            bg_color: red
            widgets: 
              - label:
                  align: TOP_MID
                  width: 100%
                  height: 100%
                  text_align: CENTER
                  translate_y: 50
                  text_font: montserrat_40
                  text: "ALARM" 
              - label:
                  align: CENTER
                  width: 100%
                  height: 100%
                  text_align: CENTER
                  translate_y: 150
                  text_font: montserrat_40
                  text: "TRIGGERED" 
              - label:
                  width: 80
                  height: 80
                  translate_x: 20
                  translate_y: 20
                  align: BOTTOM_RIGHT
                  text_color: white
                  text_font: icon_font_60
                  text: "\U000F02DC"
                  on_click:
                    if:
                      condition:
                        not:
                          - lambda: return id(alarm_status).state == "triggered"; 
                      then:
                        - lvgl.page.show: clock_page
              - button:
                  checkable: true
                  id: disarm_button
                  align: BOTTOM_MID
                  pressed:
                    bg_color: red
                  widgets:
                    - label:
                        text_font: montserrat_20
                        text: "Disarm"
                        align: CENTER  
                  on_press:
                    lvgl.page.show: disarm_page

#################### disarming page ####################
    - id: disarming_page
      widgets:
        - obj: 
            styles: triggered_content
            border_width: 0
            text_color: black
            bg_color: amber
            scrollbar_mode: "off"
            widgets: 
              - label:
                  align: TOP_MID
                  width: 100%
                  height: 100%
                  text_align: CENTER
                  translate_y: 50
                  text_font: montserrat_40
                  text: "ALARM" 

              - label:
                  align: CENTER
                  width: 100%
                  height: 100%
                  text_align: CENTER
                  translate_y: 150
                  text_font: montserrat_40
                  text: "Entrance Delay" 

              - label:
                  id: entrance_delay_lvgl
                  align: CENTER
                  width: 100%
                  height: 100%
                  text_align: CENTER
                  translate_y: 260
                  text_font: montserrat_40
                  text: " " 

              - label:
                  width: 80
                  height: 80
                  translate_x: 20
                  translate_y: 20
                  align: BOTTOM_RIGHT
                  text_color: white
                  text_font: icon_font_60
                  text: "\U000F02DC"
                  on_click:
                    if:
                      condition:
                        not:
                          - lambda: return id(alarm_status).state == "pending"; 
                      then:
                        - lvgl.page.show: clock_page
              - button:
                  checkable: true
                  id: disarm_button_2
                  align: BOTTOM_MID
                  pressed:
                    bg_color: red
                  widgets:
                    - label:
                        text_font: montserrat_20
                        text: "Disarm"
                        align: CENTER  
                  on_press:
                    lvgl.page.show: disarm_page
      on_load:
        - lvgl.widget.hide: bottom_bar  
        - script.stop: backlight_off
        - light.turn_on: back_light
      on_unload:
        - lvgl.widget.show: bottom_bar
        - script.execute: backlight_off

#################### settings page ####################
    - id: settings_page
      styles: main_content
      widgets:    
        - obj:
            width: 300
            height: 60
            align: TOP_MID
            scrollbar_mode: "OFF"         
            bg_opa: TRANSP   
            pad_all: 0
            widgets:
              - label:
                  align: CENTER
                  text_align: left
                  text_font: montserrat_20
                  text: "Settings"
                  text_color: white
                  width: 80%
                  height: 100%
                  bg_opa: COVER
                  bg_color: bg_charcoal
                  pad_top: 5
              - label:
                  id: wifi_set_lvgl
                  align: CENTER
                  text_align: right
                  text_font: icon_font_40
                  text: "\U000F08D6"
                  text_color: white
                  width: 20%
                  height: 100%
                  translate_x: 90
                  bg_opa: COVER
                  bg_color: bg_charcoal
                  pad_top: 5

        - obj:
            width: 350
            height: 310
            align: TOP_LEFT
            translate_x: 40
            translate_y: 70
            scrollbar_mode: "OFF"         
            bg_opa: TRANSP   
            pad_all: 0
            border_width: 5
        - obj:
            width: 350
            height: 310
            align: TOP_RIGHT
            translate_x: -40
            translate_y: 70
            scrollbar_mode: "OFF"         
            bg_opa: TRANSP   
            pad_all: 0
            border_width: 5

#################### status page ####################
    - id: status_page
      styles: main_content
      widgets:
        - obj:
            border_width: 0
            border_opa: 0%
            layout: 
              type: flex
              flex_flow: column
              flex_align_main: CENTER
              flex_align_track: CENTER
              flex_align_cross: CENTER
            scrollbar_mode: AUTO
            align: CENTER
            width: 100%
            height: 100%
            bg_color: black
            widgets:
              - button:
                  id: status_outside_light_button
                  hidden: true
                  widgets:
                    - label:
                        text: "Outside Light: On"
                        text_font: montserrat_20
                        text_color: white
                  on_click:
                    - homeassistant.action:
                        action: light.toggle
                        data:
                          entity_id: light.front_outside_light
              - button:
                  id: status_ceiling_light_button
                  hidden: true
                  widgets:
                    - label:
                        text: "Ceiling Light: On"
                        text_font: montserrat_20
                        text_color: white
                  on_click:
                    - switch.toggle: ceiling_light_switch
              - button:
                  id: status_stairs_light_button
                  hidden: true
                  widgets:
                    - label:
                        text: "Stairs Light: On"
                        text_font: montserrat_20
                        text_color: white
                  on_click:
                    - homeassistant.action:
                        action: light.toggle
                        data:
                          entity_id: light.stairs_led
              - button:
                  id: status_hallway_light_button
                  hidden: true
                  widgets:
                    - label:
                        text: "Hallway Ceiling: On"
                        text_font: montserrat_20
                        text_color: white
                  on_click:
                    - homeassistant.action:
                        action: light.toggle
                        data:
                          entity_id: light.hallway_ceiling
              - button:
                  id: status_living_ceiling_button
                  hidden: true
                  widgets:
                    - label:
                        text: "Livingroom Ceiling: On"
                        text_font: montserrat_20
                        text_color: white
                  on_click:
                    - homeassistant.action:
                        action: light.toggle
                        data:
                          entity_id: light.livingroom_ceiling_led_colorflux_ls3
              - button:
                  id: status_stove_light_button
                  hidden: true
                  widgets:
                    - label:
                        text: "Kitchen Stove: On"
                        text_font: montserrat_20
                        text_color: white
                  on_click:
                    - homeassistant.action:
                        action: light.toggle
                        data:
                          entity_id: light.stove
              - button:
                  id: status_dining_light_button
                  hidden: true
                  widgets:
                    - label:
                        text: "Dining Room Lights: On"
                        text_font: montserrat_20
                        text_color: white
                  on_click:
                    - homeassistant.action:
                        action: light.toggle
                        data:
                          entity_id: light.dining_room_lights
              - button:
                  id: status_all_lights_button
                  hidden: true
                  widgets:
                    - label:
                        text: "All Lights: On"
                        text_font: montserrat_20
                        text_color: white
                  on_click:
                    - homeassistant.action:
                        action: light.toggle
                        data:
                          entity_id: light.all_lights

              - label:
                  id: status_front_door_label
                  hidden: true
                  text: "Front Door: Open"
                  text_font: montserrat_20
                  text_color: white


              - label:
                  id: status_back_door_label
                  hidden: true
                  text: "Back Door: Open"
                  text_font: montserrat_20
                  text_color: white


              - label:
                  id: status_bathroom_window_label
                  hidden: true
                  text: "Bathroom Window: Open"
                  text_font: montserrat_20
                  text_color: white


              - label:
                  id: status_charles_window_label
                  hidden: true
                  text: "Charles' Window: Open"
                  text_font: montserrat_20
                  text_color: white


              - label:
                  id: status_mediaroom_window_label
                  hidden: true
                  text: "Media Room Window: Open"
                  text_font: montserrat_20
                  text_color: white


              - label:
                  id: status_stephs_window_label
                  hidden: true
                  text: "Steph's Window: Open"
                  text_font: montserrat_20
                  text_color: white
      on_load:
        - lvgl.widget.update:
            id: status_outside_light_button
            hidden: !lambda return !id(outside_light_state).state;
        - lvgl.widget.update:
            id: status_ceiling_light_button
            hidden: !lambda return !id(ceiling_light_state).state;
        - lvgl.widget.update:
            id: status_stairs_light_button
            hidden: !lambda return !id(stairs_light_state).state;
        - lvgl.widget.update:
            id: status_hallway_light_button
            hidden: !lambda return !id(hallway_state).state;
        - lvgl.widget.update:
            id: status_living_ceiling_button
            hidden: !lambda return !id(living_ceiling_state).state;
        - lvgl.widget.update:
            id: status_stove_light_button
            hidden: !lambda return !id(stove_state).state;
        - lvgl.widget.update:
            id: status_dining_light_button
            hidden: !lambda return !id(dining_light_state).state;
        - lvgl.widget.update:
            id: status_all_lights_button
            hidden: !lambda return !id(all_lights_state).state;
        - lvgl.widget.update:
            id: status_front_door_label
            hidden: !lambda return !id(front_door_state).state;
        - lvgl.widget.update:
            id: status_back_door_label
            hidden: !lambda return !id(back_door_state).state;
        - lvgl.widget.update:
            id: status_bathroom_window_label
            hidden: !lambda return !id(bathroom_window_state).state;
        - lvgl.widget.update:
            id: status_charles_window_label
            hidden: !lambda return !id(charles_window_state).state;
        - lvgl.widget.update:
            id: status_mediaroom_window_label
            hidden: !lambda return !id(mediaroom_window_state).state;
        - lvgl.widget.update:
            id: status_stephs_window_label
            hidden: !lambda return !id(stephs_window_state).state;

################## Time Set Page ####################
    - id: time_set_page
      styles: main_content
      widgets: 
        - obj: 
            width: 100%
            height: 100%
            bg_color: black
            scrollable: True
            layout: 
              type: flex
              flex_flow: column
              flex_align_main: START
              flex_align_cross: CENTER
            widgets: 
              - obj: 
                  width: 100%
                  height: 20%
                  bg_color: black
                  border_width: 0
                  layout: 
                    type: flex
                    flex_flow: row
                    flex_align_main: SPACE_AROUND
                    flex_align_cross: CENTER
                  scrollable: False
                  widgets: 
                    - label: 
                        id: time_display_label
                        text: 8:30 PM
                        text_font: montserrat_18
                        text_color: white
                        width: 60%
                        align: CENTER
                        text_align: CENTER
                    
                    - switch:
                        id: automation_toggle
                        width: 25%
                        height: 30px
                        align: CENTER
                        scrollable: False
                        on_click:
                          - homeassistant.service:
                              service: automation.toggle
                              data:
                                entity_id: automation.morning_backup

              # Hour Controls
              - obj:
                  width: 100%
                  height: 25%
                  bg_color: black
                  border_width: 0
                  layout:
                    type: flex
                    flex_flow: row
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: CENTER
                  scrollable: False
                  widgets:
                    - label:
                        id: hour_label
                        text: "Hour: 8"
                        text_font: montserrat_16
                        text_color: white
                        align: CENTER
                        text_align: CENTER

                    - button:
                        width: 35px
                        height: 35px
                        bg_color: blue_drk
                        align: CENTER
                        scrollable: False
                        widgets:
                          - label:
                              text: "-"
                              text_font: montserrat_16
                              text_color: white
                              align: CENTER
                              text_align: CENTER
                        on_click:
                          - lambda: |-
                              if (id(time_set_hour) == 1) {
                                id(time_set_hour) = 12;
                              } else {
                                id(time_set_hour)--;
                              }
                          - lvgl.label.update:
                              id: hour_label
                              text: !lambda |-
                                return "Hour: " + str_sprintf("%d", id(time_set_hour));
                          - lvgl.label.update:
                              id: time_display_label
                              text: !lambda |-
                                return str_sprintf("%d:%02d %s",
                                  id(time_set_hour),
                                  id(time_set_minute),
                                  id(time_set_am_pm).c_str()
                                );

                    - button:
                        width: 35px
                        height: 35px
                        bg_color: blue_drk
                        align: CENTER
                        scrollable: False
                        widgets:
                          - label:
                              text: "+"
                              text_font: montserrat_16
                              text_color: white
                              align: CENTER
                              text_align: CENTER
                        on_click:
                          - lambda: |-
                              if (id(time_set_hour) == 12) {
                                id(time_set_hour) = 1;
                              } else {
                                id(time_set_hour)++;
                              }
                          - lvgl.label.update:
                              id: hour_label
                              text: !lambda |-
                                return "Hour: " + str_sprintf("%d", id(time_set_hour));
                          - lvgl.label.update:
                              id: time_display_label
                              text: !lambda |-
                                return str_sprintf("%d:%02d %s",
                                  id(time_set_hour),
                                  id(time_set_minute),
                                  id(time_set_am_pm).c_str()
                                );

                    - button:
                        width: 60px
                        height: 35px
                        bg_color: blue_drk
                        align: CENTER
                        scrollable: False
                        widgets:
                          - label:
                              id: am_pm_label
                              text: "PM"
                              text_font: montserrat_16
                              text_color: white
                              align: CENTER
                              text_align: CENTER
                        on_click:
                          - lambda: |-
                              id(time_set_am_pm) = (id(time_set_am_pm) == "PM") ? "AM" : "PM";
                          - lvgl.label.update:
                              id: am_pm_label
                              text: !lambda |-
                                return id(time_set_am_pm);
                          - lvgl.label.update:
                              id: time_display_label
                              text: !lambda |-
                                return str_sprintf("%d:%02d %s",
                                  id(time_set_hour),
                                  id(time_set_minute),
                                  id(time_set_am_pm).c_str()
                                );

              # Minute Controls
              - obj:
                  width: 100%
                  height: 25%
                  bg_color: black
                  border_width: 0
                  layout:
                    type: flex
                    flex_flow: row
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: CENTER
                  scrollable: False
                  widgets:
                    - label:
                        id: minute_label
                        text: "Minute: 30"
                        text_font: montserrat_16
                        text_color: white
                        align: CENTER
                        text_align: CENTER

                    - button:
                        width: 35px
                        height: 35px
                        bg_color: blue_drk
                        align: CENTER
                        scrollable: False
                        widgets:
                          - label:
                              text: "-"
                              text_font: montserrat_16
                              text_color: white
                              align: CENTER
                              text_align: CENTER
                        on_click:
                          - lambda: |-
                              if (id(time_set_minute) == 0) {
                                id(time_set_minute) = 59;
                              } else {
                                id(time_set_minute)--;
                              }
                          - lvgl.label.update:
                              id: minute_label
                              text: !lambda |-
                                return "Minute: " + str_sprintf("%02d", id(time_set_minute));
                          - lvgl.label.update:
                              id: time_display_label
                              text: !lambda |-
                                return str_sprintf("%d:%02d %s",
                                  id(time_set_hour),
                                  id(time_set_minute),
                                  id(time_set_am_pm).c_str()
                                );

                    - button:
                        width: 35px
                        height: 35px
                        bg_color: blue_drk
                        align: CENTER
                        scrollable: False
                        widgets:
                          - label:
                              text: "+"
                              text_font: montserrat_16
                              text_color: white
                              align: CENTER
                              text_align: CENTER
                        on_click:
                          - lambda: |-
                              if (id(time_set_minute) == 59) {
                                id(time_set_minute) = 0;
                              } else {
                                id(time_set_minute)++;
                              }
                          - lvgl.label.update:
                              id: minute_label
                              text: !lambda |-
                                return "Minute: " + str_sprintf("%02d", id(time_set_minute));
                          - lvgl.label.update:
                              id: time_display_label
                              text: !lambda |-
                                return str_sprintf("%d:%02d %s",
                                  id(time_set_hour),
                                  id(time_set_minute),
                                  id(time_set_am_pm).c_str()
                                );

              # Set/Cancel Buttons
              - obj:
                  width: 100%
                  height: 30%
                  bg_color: black
                  border_width: 0
                  layout:
                    type: flex
                    flex_flow: row
                    flex_align_main: SPACE_EVENLY
                    flex_align_cross: CENTER
                  scrollable: False
                  widgets:
                    - button:
                        width: 45%
                        height: 35px
                        align: CENTER
                        scrollable: False
                        widgets:
                          - label:
                              text: "Set"
                              text_font: montserrat_16
                              align: CENTER
                              text_align: CENTER
                        on_click:
                          - homeassistant.service:
                              service: input_datetime.set_datetime
                              data:
                                entity_id: input_datetime.time
                                time: !lambda |-
                                  int hour_24 = id(time_set_hour);
                                  if (id(time_set_am_pm) == "PM") {
                                    if (hour_24 != 12) {
                                      hour_24 += 12;
                                    }
                                  } else {
                                    if (hour_24 == 12) {
                                      hour_24 = 0;
                                    }
                                  }
                                  return str_sprintf("%02d:%02d:00", hour_24, id(time_set_minute));
                          - lvgl.page.show: clock_page

                    - button:
                        width: 45%
                        height: 35px
                        align: CENTER
                        scrollable: False
                        widgets:
                          - label:
                              text: "Cancel"
                              text_font: montserrat_16
                              align: CENTER
                              text_align: CENTER
                        on_click:
                          - lvgl.page.show: clock_page
      
      on_load:
        - lvgl.widget.hide: bottom_bar
        - lambda: |-
            // Get time from input_datetime.time entity
            std::string time_str = id(input_datetime_time).state;
            int hour_24 = 8;  // Default values if parsing fails
            int minute = 30;
            
            // Parse HH:MM:SS or HH:MM format
            if (time_str.length() >= 5) {
              size_t colon_pos = time_str.find(":");
              if (colon_pos != std::string::npos) {
                hour_24 = atoi(time_str.substr(0, colon_pos).c_str());
                minute = atoi(time_str.substr(colon_pos+1, 2).c_str());
              }
            }
            
            // Convert to 12-hour format
            id(time_set_hour) = (hour_24 % 12 == 0) ? 12 : (hour_24 % 12);
            id(time_set_am_pm) = (hour_24 < 12) ? "AM" : "PM";
            id(time_set_minute) = minute;
        - lvgl.widget.update:
            id: automation_toggle
            state:
              checked: !lambda return id(morning_backup_automation).state;
        - lvgl.label.update:
            id: hour_label
            text: !lambda |-
              return "Hour: " + str_sprintf("%d", id(time_set_hour));
        - lvgl.label.update:
            id: minute_label
            text: !lambda |-
              return "Minute: " + str_sprintf("%02d", id(time_set_minute));
        - lvgl.label.update:
            id: time_display_label
            text: !lambda |-
              return str_sprintf("%d:%02d %s",
                id(time_set_hour),
                id(time_set_minute),
                id(time_set_am_pm).c_str()
              );
      on_unload:
        - lvgl.widget.show: bottom_bar
